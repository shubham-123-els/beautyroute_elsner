<?php /** * @category FishPig * @package FishPig_WordPress * @author Ben Tideswell <help@fishpig.co.uk> */ ?> <?php $helper = $this->helper('Elsnertech\Customization\Helper\Data'); $currentStore = $helper->getStoreName(); $currentStore = strtolower($currentStore); $webConfig = $helper->getwebConfig(); $baseurl = $helper->getBaseUrl()."blog"; $restrictedsite = ("/fr/blog/category/english"); if ($currentStore=="english") { $currentlinkurl = str_replace("?___from_store=en",'',$helper->currentUrl()); } else { $currentlinkurl = str_replace("?___from_store=fr",'',$helper->currentUrl()); } if ($currentlinkurl==$baseurl && $currentStore=="english") { $redirect = $helper->getredirectBlogPage(); $redirect->setRedirect('/blog/category/english'); } if ($currentlinkurl==$baseurl && $currentStore=="french") { $redirect = $helper->getredirectBlogPage(); $redirect->setRedirect('/fr/blog/category/french'); } if ($currentlinkurl==$helper->getBaseUrl()."blog/category/english" && $currentStore=="french") { $redirect = $helper->getredirectBlogPage(); $redirect->setRedirect('/fr/blog/category/french'); } if ($currentlinkurl==$helper->getBaseUrl()."blog/category/french" && $currentStore=="english") { $redirect = $helper->getredirectBlogPage(); $redirect->setRedirect('/blog/category/english'); } ?> <?php $posts = $block->getPosts() ?> <?php if (count($posts) > 0): ?> <div class="post-list-wrapper"><ol class="post-list grid"><?php foreach ($posts as $post): ?> <?php $category = $post->getCatagoryName('category'); $cataeoryName = explode('&',$category); $cataeoryName = str_replace('amp;',' ',$cataeoryName); ?> <?php if ($renderedPostHtml = $block->renderPost($post)): ?> <?php if (in_array($currentStore,$cataeoryName)): ?> <li class="item<?php if ($post->isSticky()): ?> featured is-sticky<?php endif; ?> <?= $block->escapeHtml($post->getPostFormat()) ?>"><?php if ($currentStore=="French") { $renderedPostHtml = str_replace($webConfig."pub/","/pub/",$renderedPostHtml); $renderedPostHtml = str_replace($webConfig,$webConfig."fr/",$renderedPostHtml); } ?> <div class="post-list-item"><?php if ($image = $post->getImage()): ?> <a href="<?= $block->escapeUrl($post->getUrl()) ?>" class="img-wrapper"><?php $imageUrl = $image->getResizer() ? $image->getResizer()->constrainOnly(true)->keepFrame(false)->keepAspectRatio(true)->resize(600, null) : '' ?> <?php $imageUrl = str_replace($webConfig,"/pub/",$imageUrl); ?> <img src="<?= $block->escapeUrl($imageUrl) ?>" alt="<?= $block->escapeHtml($post->getName()) ?>"/></a> <?php endif; ?> <div class="content-wrapper"><div class="content-body"><?php if ($categoryString = $post->getTermCollectionAsString('category')): ?> <?php endif; ?> <h2><a href="<?= $block->escapeUrl($post->getUrl()) ?>" title="<?= $block->escapeHtml($post->getName()) ?>"><?= $block->escapeHtml($post->getName()) ?></a></h2><div class="rte"><?= $post->getExcerpt(60) ?></div><?php if ($tagString = $post->getTermCollectionAsString('post_tag')): ?> <div class="tags-wrapper"><?php $tagString = str_replace('&',' ',$tagString); ?> <?php $tagString = str_replace('amp; ',' ',$tagString); ?> <?php $tagString = str_replace(', ',' ',$tagString); ?> <?= $tagString ?></div><?php endif; ?></div><div class="content-footer"><div class="posted-by"><label><?= __('By') ?>:</label> <a href="<?= $block->escapeUrl($post->getUser()->getUrl()) ?>"><?= $block->escapeHtml($post->getUser()->getDisplayName()) ?></a></div><div class="posted-date"><label><?= $block->escapeHtml($post->getPostDate()) ?></label></div></div></div><!-- <h2><a href="<?= $block->escapeUrl($post->getUrl()) ?>" title="<?= $block->escapeHtml($post->getName()) ?>"><?= $block->escapeHtml($post->getName()) ?></a></h2><?php if (!$post->isViewableForVisitor()): ?> <?= $block->getPasswordProtectHtml() ?> <?php else: ?> <div class="post-entry"><?php if ($image = $post->getImage()): ?> <div class="post-image"><a href="<?= $block->escapeUrl($post->getUrl()) ?>" title="<?= $block->escapeHtml($post->getName()) ?>"><img src="<?= $block->escapeUrl($imageUrl) ?>" alt="<?= $block->escapeHtml($post->getName()) ?>"/></a></div><?php endif; ?> <div class="post-excerpt"><?= $post->getExcerpt(60) ?></div></div><?php endif; ?> <div class="post-meta"><?php if ($tagString = $post->getTermCollectionAsString('post_tag')): ?> <div class="post-tags post-meta-item"><strong><?= __('Tags') ?>:</strong> <?= $tagString ?></div><?php endif; ?> <div class="post-date post-meta-item"><strong><?= __('Posted On') ?>:</strong> <?= $block->escapeHtml($post->getPostDate()) ?></div><div class="post-user post-meta-item"><strong><?= __('Posted By') ?>:</strong> <a href="<?= $block->escapeUrl($post->getUser()->getUrl()) ?>"><?= $block->escapeHtml($post->getUser()->getDisplayName()) ?></a></div></div> --></div></li> <?php endif; ?> <?php endif; ?> <?php endforeach; ?></ol><?= $block->getPagerHtml() ?></div><?php endif; ?>